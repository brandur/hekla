(function(c){function n(a,b,e){e=o(b,e);b=a.currentTarget;if("A"!==b.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(1<a.which||a.metaKey||a.ctrlKey))if(!(location.protocol!==b.protocol||location.host!==b.host)&&!(b.hash&&b.href.replace(b.hash,"")===location.href.replace(location.hash,""))&&b.href!==location.href+"#")b={url:b.href,container:c(b).attr("data-pjax"),target:b,clickedElement:c(b),fragment:null},c.pjax(c.extend({},b,e)),a.preventDefault()}function s(a){var b=
document.createElement("a");b.href=a;return b}function o(a,b){a&&b?b.container=a:b=c.isPlainObject(a)?a:{container:a};b.container&&(b.container=u(b.container));return b}function u(a){a=c(a);if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return c("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}function q(a,b){var e=c();a.each(function(){c(this).is(b)&&(e=e.add(this));e=e.add(b,this)});return e}function v(a,b,
e){var d={},b=(b.getResponseHeader("X-PJAX-URL")||e.requestUrl).replace(/\?_pjax=[^&]+&?/,"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"");d.url=b;b=c(a);if(0===b.length)return d;d.title=q(b,"title").last().text();e.fragment?(a=q(b,e.fragment).first(),a.length&&(d.contents=a.contents(),d.title||(d.title=a.attr("title")||a.data("title")))):/<html/i.test(a)||(d.contents=b);d.contents&&(d.contents=d.contents.not("title"),d.contents.find("title").remove());d.title&&(d.title=c.trim(d.title));return d}
c.fn.pjax=function(a,b){return this.live("click.pjax",function(c){n(c,a,b)})};var f=c.pjax=function(a){function b(a,b){var d=c.Event(a,{relatedTarget:e});l.trigger(d,b);return!d.isDefaultPrevented()}a=c.extend(!0,{},c.ajaxSettings,f.defaults,a);c.isFunction(a.url)&&(a.url=a.url());var e=a.target;!e&&a.clickedElement&&(e=a.clickedElement[0]);var d=s(a.url).hash,h=a.beforeSend,j=a.complete,k=a.success,n=a.error,l=a.context=u(a.container);a.data||(a.data={});a.data._pjax=l.selector;var t;a.beforeSend=
function(c,d){if(d.timeout>0){t=setTimeout(function(){b("pjax:timeout",[c,a])&&c.abort("timeout")},d.timeout);d.timeout=0}c.setRequestHeader("X-PJAX","true");c.setRequestHeader("X-PJAX-Container",l.selector);var e;if(h){e=h.apply(this,arguments);if(e===false)return false}if(!b("pjax:beforeSend",[c,d]))return false;a.requestUrl=s(d.url).href};a.complete=function(c,d){t&&clearTimeout(t);j&&j.apply(this,arguments);b("pjax:complete",[c,d,a]);b("pjax:end",[c,a]);b("end.pjax",[c,a])};a.error=function(c,
d,e){var f=v("",c,a);n&&n.apply(this,arguments);var k=b("pjax:error",[c,d,e,a]);if(d!=="abort"&&k)window.location=f.url};a.success=function(e,i,j){var g=v(e,j,a);if(g.contents){f.state={id:a.id||(new Date).getTime(),url:g.url,title:g.title,container:l.selector,fragment:a.fragment,timeout:a.timeout};(a.push||a.replace)&&window.history.replaceState(f.state,g.title,g.url);if(g.title)document.title=g.title;l.html(g.contents);typeof a.scrollTo==="number"&&c(window).scrollTop(a.scrollTo);(a.replace||a.push)&&
window._gaq&&_gaq.push(["_trackPageview"]);if(d!==""){var h=s(g.url);h.hash=d;f.state.url=h.href;window.history.replaceState(f.state,g.title,h.href);g=c(h.hash);g.length&&c(window).scrollTop(g.offset().top)}k&&k.apply(this,arguments);b("pjax:success",[e,i,j,a])}else window.location=g.url};f.state||(f.state={id:(new Date).getTime(),url:window.location.href,title:document.title,container:l.selector,fragment:a.fragment,timeout:a.timeout},window.history.replaceState(f.state,document.title));var i=f.xhr;
i&&4>i.readyState&&(i.onreadystatechange=c.noop,i.abort());f.options=a;i=f.xhr=c.ajax(a);if(0<i.readyState){c(document).trigger("pjax",[i,a]);if(a.push&&!a.replace){var o=f.state.id,q=l.clone().contents();m[o]=q;for(p.push(o);r.length;)delete m[r.shift()];for(;p.length>f.defaults.maxCacheLength;)delete m[p.shift()];window.history.pushState(null,"",a.url)}b("pjax:start",[i,a]);b("start.pjax",[i,a]);b("pjax:send",[i,a])}return f.xhr};f.reload=function(a,b){return c.pjax(c.extend({url:window.location.href,
push:!1,replace:!0,scrollTo:!1},o(a,b)))};f.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html",scrollTo:0,maxCacheLength:20};var m={},r=[],p=[];f.click=n;c(window).bind("popstate",function(a){if((a=a.state)&&a.container){var b=c(a.container);if(b.length){var e=m[a.id];if(f.state){var d=f.state.id<a.id?"forward":"back",h=d,j=f.state.id,k=b.clone().contents();m[j]=k;"forward"===h?(h=p,k=r):(h=r,k=p);h.push(j);(j=k.pop())&&delete m[j]}d=c.Event("pjax:popstate",{state:a,direction:d});
b.trigger(d);d={id:a.id,url:a.url,container:b,push:!1,fragment:a.fragment,timeout:a.timeout,scrollTo:!1};e?(c(document).trigger("pjax",[null,d]),b.trigger("pjax:start",[null,d]),b.trigger("start.pjax",[null,d]),a.title&&(document.title=a.title),b.html(e),f.state=a,b.trigger("pjax:end",[null,d]),b.trigger("end.pjax",[null,d])):c.pjax(d);b[0].offsetHeight}else window.location=location.href}});0>c.inArray("state",c.event.props)&&c.event.props.push("state");c.support.pjax=window.history&&window.history.pushState&&
window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);c.support.pjax||(c.pjax=function(a){var b=c.isFunction(a.url)?a.url():a.url,e=a.type?a.type.toUpperCase():"GET",d=c("<form>",{method:"GET"===e?"GET":"POST",action:b,style:"display:none"});"GET"!==e&&"POST"!==e&&d.append(c("<input>",{type:"hidden",name:"_method",value:e.toLowerCase()}));a=a.data;if("string"===typeof a)c.each(a.split("&"),function(a,b){var e=b.split("=");d.append(c("<input>",
{type:"hidden",name:e[0],value:e[1]}))});else if("object"===typeof a)for(key in a)d.append(c("<input>",{type:"hidden",name:key,value:a[key]}));c(document.body).append(d);d.submit()},c.pjax.click=c.noop,c.pjax.reload=window.location.reload,c.fn.pjax=function(){return this})})(jQuery);
